<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Shop Finder</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 20px;
            background-color: #f5f5f5;
        }
        h1, h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        .form-container {
            margin-bottom: 40px;
        }
        .shop-item {
            margin-bottom: 20px;
        }
        .search-result-item {
            margin-bottom: 20px;
        }
        .footer {
            text-align: center;
            padding: 10px;
            background-color: #f1f1f1;
            width: 100%;
            bottom: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Minecraft Shop Finder</h1>

        <div class="form-container">
            <h2>Add a Shop</h2>
            <form id="addShopForm" class="form-group">
                <label for="shopName">Shop Name:</label>
                <input type="text" id="shopName" name="name" class="form-control" required>

                <label for="coordinates" class="mt-3">Coordinates:</label>
                <input type="text" id="coordinates" name="coordinates" class="form-control" required>

                <label for="username" class="mt-3">Owners Name:</label>
                <input type="text" id="username" name="username" class="form-control" required>

                <button type="submit" class="btn btn-primary mt-3">Add Shop</button>
            </form>
        </div>

        <div class="form-container">
            <h2>Add an Item</h2>
            <form id="addItemForm" class="form-group">
                <label for="itemName">Item Name:</label>
                <input type="text" id="itemName" name="item_name" class="form-control" required>

                <label for="price" class="mt-3">Price:</label>
                <input type="number" id="price" name="price" step="0.01" class="form-control" required>

                <label for="shopId" class="mt-3">Shop ID:</label>
                <input type="number" id="shopId" name="shop_id" class="form-control" required>

                <button type="submit" class="btn btn-primary mt-3">Add Item</button>
            </form>
        </div>

        <div class="form-container">
            <h2>Search for Items</h2>
            <form id="searchForm" class="form-group">
                <label for="searchItem">Search Item:</label>
                <input type="text" id="searchItem" name="item_name" class="form-control" required>

                <button type="submit" class="btn btn-primary mt-3">Search</button>
            </form>
        </div>

        <h2>Search Results</h2>
        <div id="searchResults" class="search-results-container"></div>

        <h2>All Shops</h2>
        <div id="shopsList" class="shops-list-container"></div>
    </div>

    <div class="footer">
        <p>Here is the <a href="https://github.com/micfun123/CKShops" target="_blank">GitHub</a></p>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        const addShopForm = document.getElementById('addShopForm');
        const addItemForm = document.getElementById('addItemForm');
        const searchForm = document.getElementById('searchForm');
        const shopsListDiv = document.getElementById('shopsList');
        const searchResultsDiv = document.getElementById('searchResults');

        // Function to fetch and display all shops
        async function fetchAndDisplayShops() {
            const response = await fetch('/shops');
            const data = await response.json();
            
            shopsListDiv.innerHTML = '';
            data.forEach(shop => {
                const shopDiv = document.createElement('div');
                shopDiv.classList.add('shop-item', 'card', 'p-3');
                shopDiv.innerHTML = `
                    <h3>Shop ID: ${shop.shop_id}</h3>
                    <p><strong>Name:</strong> ${shop.name}</p>
                    <p><strong>Owner:</strong> ${shop.owner}</p>
                    <p><strong>Coordinates:</strong> ${shop.coordinates}</p>
                    <hr>
                `;
                shopsListDiv.appendChild(shopDiv);
            });
        }

        addShopForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const formData = new FormData(addShopForm);

            const response = await fetch('/add_shop', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            alert(data.message); // Show message (optional)
            await fetchAndDisplayShops(); // Refresh shops list
        });

        addItemForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const formData = new FormData(addItemForm);

            const response = await fetch('/add_item', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            alert(data.message); // Show message (optional)
        });

        searchForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const formData = new FormData(searchForm);
            const item_name = formData.get('item_name');

            const response = await fetch(`/search?item_name=${item_name}`);
            const data = await response.json();

            searchResultsDiv.innerHTML = '';
            if (data.length === 0) {
                searchResultsDiv.innerHTML = '<p>No items found.</p>';
            } else {
                data.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.classList.add('search-result-item', 'card', 'p-3');
                    itemDiv.innerHTML = `
                        <h3>${item.item_name}</h3>
                        <p><strong>Price:</strong> ${item.price}</p>
                        <p><strong>Shop Name:</strong> ${item.shop_name}</p>
                        <p><strong>Coordinates:</strong> ${item.coordinates}</p>
                        <hr>
                    `;
                    searchResultsDiv.appendChild(itemDiv);
                });
            }
        });

        // Initial fetch and display of shops
        fetchAndDisplayShops();
    </script>
    <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="Michaelrbparker" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF5F5F" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
</body>
</html>
